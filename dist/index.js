class R extends Error{response;request;options;constructor(t,e,a){const r=t.status||t.status===0?t.status:"",n=t.statusText??"",o=`${r} ${n}`.trim(),c=o?`status code ${o}`:"an unknown error";super(`Request failed with ${c}: ${e.method} ${e.url}`),this.name="HTTPError",this.response=t,this.request=e,this.options=a}}class $ extends Error{name="NonError";value;constructor(t){let e="Non-error value was thrown";try{typeof t=="string"?e=t:t&&typeof t=="object"&&"message"in t&&typeof t.message=="string"&&(e=t.message)}catch{}super(e),this.value=t}}class P extends Error{name="ForceRetryError";customDelay;code;customRequest;constructor(t){const e=t?.cause?t.cause instanceof Error?t.cause:new $(t.cause):void 0;super(t?.code?`Forced retry: ${t.code}`:"Forced retry",e?{cause:e}:void 0),this.customDelay=t?.delay,this.code=t?.code,this.customRequest=t?.request}}const j=(()=>{let s=!1,t=!1;const e=typeof globalThis.ReadableStream=="function",a=typeof globalThis.Request=="function";if(e&&a)try{t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type")}catch(r){if(r instanceof Error&&r.message==="unsupported BodyInit type")return!1;throw r}return s&&!t})(),W=typeof globalThis.AbortController=="function",q=typeof globalThis.AbortSignal=="function"&&typeof globalThis.AbortSignal.any=="function",K=typeof globalThis.ReadableStream=="function",X=typeof globalThis.FormData=="function",C=["get","post","put","patch","head","delete"],Y={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},T=2147483647,Q=new TextEncoder().encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,_=Symbol("stop");class L{options;constructor(t){this.options=t}}const Z=s=>new L(s),tt={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0,context:!0},et={next:!0},st={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,duplex:!0},at=s=>{if(!s)return 0;if(s instanceof FormData){let t=0;for(const[e,a]of s)t+=Q,t+=new TextEncoder().encode(`Content-Disposition: form-data; name="${e}"`).length,t+=typeof a=="string"?new TextEncoder().encode(a).length:a.size;return t}if(s instanceof Blob)return s.size;if(s instanceof ArrayBuffer)return s.byteLength;if(typeof s=="string")return new TextEncoder().encode(s).length;if(s instanceof URLSearchParams)return new TextEncoder().encode(s.toString()).length;if("byteLength"in s)return s.byteLength;if(typeof s=="object"&&s!==null)try{const t=JSON.stringify(s);return new TextEncoder().encode(t).length}catch{return 0}return 0},O=(s,t,e)=>{let a,r=0;return s.pipeThrough(new TransformStream({transform(n,o){if(o.enqueue(n),a){r+=a.byteLength;let c=t===0?0:r/t;c>=1&&(c=1-Number.EPSILON),e?.({percent:c,totalBytes:Math.max(t,r),transferredBytes:r},a)}a=n},flush(){a&&(r+=a.byteLength,e?.({percent:1,totalBytes:Math.max(t,r),transferredBytes:r},a))}}))},rt=(s,t)=>{if(!s.body)return s;if(s.status===204)return new Response(null,{status:s.status,statusText:s.statusText,headers:s.headers});const e=Math.max(0,Number(s.headers.get("content-length"))||0);return new Response(O(s.body,e,t),{status:s.status,statusText:s.statusText,headers:s.headers})},nt=(s,t,e)=>{if(!s.body)return s;const a=at(e??s.body);return new Request(s,{duplex:"half",body:O(s.body,a,t)})},d=s=>s!==null&&typeof s=="object",w=(...s)=>{for(const t of s)if((!d(t)||Array.isArray(t))&&t!==void 0)throw new TypeError("The `options` argument must be an object");return S({},...s)},N=(s={},t={})=>{const e=new globalThis.Headers(s),a=t instanceof globalThis.Headers,r=new globalThis.Headers(t);for(const[n,o]of r.entries())a&&o==="undefined"||o===void 0?e.delete(n):e.set(n,o);return e};function k(s,t,e){return Object.hasOwn(t,e)&&t[e]===void 0?[]:S(s[e]??[],t[e]??[])}const D=(s={},t={})=>({beforeRequest:k(s,t,"beforeRequest"),beforeRetry:k(s,t,"beforeRetry"),afterResponse:k(s,t,"afterResponse"),beforeError:k(s,t,"beforeError")}),ot=(s,t)=>{const e=new URLSearchParams;for(const a of[s,t])if(a!==void 0)if(a instanceof URLSearchParams)for(const[r,n]of a.entries())e.append(r,n);else if(Array.isArray(a))for(const r of a){if(!Array.isArray(r)||r.length!==2)throw new TypeError("Array search parameters must be provided in [[key, value], ...] format");e.append(String(r[0]),String(r[1]))}else if(d(a))for(const[r,n]of Object.entries(a))n!==void 0&&e.append(r,String(n));else{const r=new URLSearchParams(a);for(const[n,o]of r.entries())e.append(n,o)}return e},S=(...s)=>{let t={},e={},a={},r;const n=[];for(const o of s)if(Array.isArray(o))Array.isArray(t)||(t=[]),t=[...t,...o];else if(d(o)){for(let[c,i]of Object.entries(o)){if(c==="signal"&&i instanceof globalThis.AbortSignal){n.push(i);continue}if(c==="context"){if(i!=null&&(!d(i)||Array.isArray(i)))throw new TypeError("The `context` option must be an object");t={...t,context:i==null?{}:{...t.context,...i}};continue}if(c==="searchParams"){i==null?r=void 0:r=r===void 0?i:ot(r,i);continue}d(i)&&c in t&&(i=S(t[c],i)),t={...t,[c]:i}}d(o.hooks)&&(a=D(a,o.hooks),t.hooks=a),d(o.headers)&&(e=N(e,o.headers),t.headers=e)}return r!==void 0&&(t.searchParams=r),n.length>0&&(n.length===1?t.signal=n[0]:q?t.signal=AbortSignal.any(n):t.signal=n.at(-1)),t.context===void 0&&(t.context={}),t},it=s=>C.includes(s)?s.toUpperCase():s,ct=["get","put","head","delete","options","trace"],lt=[408,413,429,500,502,503,504],ut=[413,429,503],E={limit:2,methods:ct,statusCodes:lt,afterStatusCodes:ut,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:s=>.3*2**(s-1)*1e3,jitter:void 0,retryOnTimeout:!1},pt=(s={})=>{if(typeof s=="number")return{...E,limit:s};if(s.methods&&!Array.isArray(s.methods))throw new Error("retry.methods must be an array");if(s.statusCodes&&!Array.isArray(s.statusCodes))throw new Error("retry.statusCodes must be an array");return{...E,...s}};class I extends Error{request;constructor(t){super(`Request timed out: ${t.method} ${t.url}`),this.name="TimeoutError",this.request=t}}async function ft(s,t,e,a){return new Promise((r,n)=>{const o=setTimeout(()=>{e&&e.abort(),n(new I(s))},a.timeout);a.fetch(s,t).then(r).catch(n).then(()=>{clearTimeout(o)})})}async function ht(s,{signal:t}){return new Promise((e,a)=>{t&&(t.throwIfAborted(),t.addEventListener("abort",r,{once:!0}));function r(){clearTimeout(n),a(t.reason)}const n=setTimeout(()=>{t?.removeEventListener("abort",r),e()},s)})}const dt=(s,t)=>{const e={};for(const a in t)Object.hasOwn(t,a)&&!(a in st)&&!(a in tt)&&(!(a in s)||a in et)&&(e[a]=t[a]);return e},mt=s=>s===void 0?!1:Array.isArray(s)?s.length>0:s instanceof URLSearchParams?s.size>0:typeof s=="object"?Object.keys(s).length>0:typeof s=="string"?s.trim().length>0:!!s;function yt(s){return s instanceof R||s?.name===R.name}function gt(s){return s instanceof I||s?.name===I.name}class g{static create(t,e){const a=new g(t,e),r=async()=>{if(typeof a.#t.timeout=="number"&&a.#t.timeout>T)throw new RangeError(`The \`timeout\` option cannot be greater than ${T}`);await Promise.resolve();let o=await a.#m();for(const c of a.#t.hooks.afterResponse){const i=a.#u(o.clone()),f=await c(a.request,a.#i(),i,{retryCount:a.#s});if(f instanceof globalThis.Response&&(o=f),f instanceof L)throw await Promise.all([i.body?.cancel(),o.body?.cancel()]),new P(f.options)}if(a.#u(o),!o.ok&&(typeof a.#t.throwHttpErrors=="function"?a.#t.throwHttpErrors(o.status):a.#t.throwHttpErrors)){let c=new R(o,a.request,a.#i());for(const i of a.#t.hooks.beforeError)c=await i(c,{retryCount:a.#s});throw c}if(a.#t.onDownloadProgress){if(typeof a.#t.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!K)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return rt(o.clone(),a.#t.onDownloadProgress)}return o},n=a.#p(r).finally(async()=>{const o=a.#n,c=[];o&&!o.bodyUsed&&c.push(o.body?.cancel()),a.request.bodyUsed||c.push(a.request.body?.cancel()),await Promise.all(c)});for(const[o,c]of Object.entries(Y))o==="bytes"&&typeof globalThis.Response?.prototype?.bytes!="function"||(n[o]=async()=>{a.request.headers.set("accept",a.request.headers.get("accept")||c);const i=await n;if(o==="json"){if(i.status===204)return"";const f=await i.text();return f===""?"":e.parseJson?e.parseJson(f):JSON.parse(f)}return i[o]()});return n}static#h(t){return t&&typeof t=="object"&&!Array.isArray(t)&&!(t instanceof URLSearchParams)?Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0)):t}request;#a;#s=0;#e;#t;#n;#r;#o;constructor(t,e={}){if(this.#e=t,this.#t={...e,headers:N(this.#e.headers,e.headers),hooks:D({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},e.hooks),method:it(e.method??this.#e.method??"GET"),prefixUrl:String(e.prefixUrl||""),retry:pt(e.retry),throwHttpErrors:e.throwHttpErrors??!0,timeout:e.timeout??1e4,fetch:e.fetch??globalThis.fetch.bind(globalThis),context:e.context??{}},typeof this.#e!="string"&&!(this.#e instanceof URL||this.#e instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this.#t.prefixUrl&&typeof this.#e=="string"){if(this.#e.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this.#t.prefixUrl.endsWith("/")||(this.#t.prefixUrl+="/"),this.#e=this.#t.prefixUrl+this.#e}W&&q&&(this.#r=this.#t.signal??this.#e.signal,this.#a=new globalThis.AbortController,this.#t.signal=this.#r?AbortSignal.any([this.#r,this.#a.signal]):this.#a.signal),j&&(this.#t.duplex="half"),this.#t.json!==void 0&&(this.#t.body=this.#t.stringifyJson?.(this.#t.json)??JSON.stringify(this.#t.json),this.#t.headers.set("content-type",this.#t.headers.get("content-type")??"application/json"));const a=e.headers&&new globalThis.Headers(e.headers).has("content-type");if(this.#e instanceof globalThis.Request&&(X&&this.#t.body instanceof globalThis.FormData||this.#t.body instanceof URLSearchParams)&&!a&&this.#t.headers.delete("content-type"),this.request=new globalThis.Request(this.#e,this.#t),mt(this.#t.searchParams)){const n="?"+(typeof this.#t.searchParams=="string"?this.#t.searchParams.replace(/^\?/,""):new URLSearchParams(g.#h(this.#t.searchParams)).toString()),o=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,n);this.request=new globalThis.Request(o,this.#t)}if(this.#t.onUploadProgress){if(typeof this.#t.onUploadProgress!="function")throw new TypeError("The `onUploadProgress` option must be a function");if(!j)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request=this.#f(this.request,this.#t.body??void 0)}}#c(){const t=this.#t.retry.delay(this.#s);let e=t;return this.#t.retry.jitter===!0?e=Math.random()*t:typeof this.#t.retry.jitter=="function"&&(e=this.#t.retry.jitter(t),(!Number.isFinite(e)||e<0)&&(e=t)),Math.min(this.#t.retry.backoffLimit,e)}async#d(t){if(this.#s++,this.#s>this.#t.retry.limit)throw t;const e=t instanceof Error?t:new $(t);if(e instanceof P)return e.customDelay??this.#c();if(!this.#t.retry.methods.includes(this.request.method.toLowerCase()))throw t;if(this.#t.retry.shouldRetry!==void 0){const a=await this.#t.retry.shouldRetry({error:e,retryCount:this.#s});if(a===!1)throw t;if(a===!0)return this.#c()}if(gt(t)&&!this.#t.retry.retryOnTimeout)throw t;if(yt(t)){if(!this.#t.retry.statusCodes.includes(t.response.status))throw t;const a=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Retry-After")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(a&&this.#t.retry.afterStatusCodes.includes(t.response.status)){let r=Number(a)*1e3;Number.isNaN(r)?r=Date.parse(a)-Date.now():r>=Date.parse("2024-01-01")&&(r-=Date.now());const n=this.#t.retry.maxRetryAfter??r;return r<n?r:n}if(t.response.status===413)throw t}return this.#c()}#u(t){return this.#t.parseJson&&(t.json=async()=>this.#t.parseJson(await t.text())),t}async#p(t){try{return await t()}catch(e){const a=Math.min(await this.#d(e),T);if(this.#s<1)throw e;if(await ht(a,this.#r?{signal:this.#r}:{}),e instanceof P&&e.customRequest){const r=this.#t.signal?new globalThis.Request(e.customRequest,{signal:this.#t.signal}):new globalThis.Request(e.customRequest);this.#l(r)}for(const r of this.#t.hooks.beforeRetry){const n=await r({request:this.request,options:this.#i(),error:e,retryCount:this.#s});if(n instanceof globalThis.Request){this.#l(n);break}if(n instanceof globalThis.Response)return n;if(n===_)return}return this.#p(t)}}async#m(){this.#a?.signal.aborted&&(this.#a=new globalThis.AbortController,this.#t.signal=this.#r?AbortSignal.any([this.#r,this.#a.signal]):this.#a.signal,this.request=new globalThis.Request(this.request,{signal:this.#t.signal}));for(const e of this.#t.hooks.beforeRequest){const a=await e(this.request,this.#i(),{retryCount:this.#s});if(a instanceof Response)return a;if(a instanceof globalThis.Request){this.#l(a);break}}const t=dt(this.request,this.#t);return this.#n=this.request,this.request=this.#n.clone(),this.#t.timeout===!1?this.#t.fetch(this.#n,t):ft(this.#n,t,this.#a,this.#t)}#i(){if(!this.#o){const{hooks:t,...e}=this.#t;this.#o=Object.freeze(e)}return this.#o}#l(t){this.#o=void 0,this.request=this.#f(t)}#f(t,e){return!this.#t.onUploadProgress||!t.body?t:nt(t,this.#t.onUploadProgress,e??this.#t.body??void 0)}}/*! MIT License Â© Sindre Sorhus */const v=s=>{const t=(e,a)=>g.create(e,w(s,a));for(const e of C)t[e]=(a,r)=>g.create(a,w(s,r,{method:e}));return t.create=e=>v(w(e)),t.extend=e=>(typeof e=="function"&&(e=e(s??{})),v(w(s,e))),t.stop=_,t.retry=Z,t},M=v(),bt="https://accounts.spotify.com/api/token",p="https://api.spotify.com/v1",wt=()=>localStorage.getItem("clientId")||"",U=s=>{application.postUiMessage(s)},z=(s,t)=>{localStorage.setItem("access_token",s),t&&localStorage.setItem("refresh_token",t)},l=M.create({hooks:{beforeRequest:[s=>{s.headers.set("Authorization",`Bearer ${localStorage.getItem("access_token")}`)}],afterResponse:[async(s,t,e)=>{if(e.status===401){const a=await H();return s.headers.set("Authorization",`Bearer ${a}`),l(s,t)}}]}}),H=async()=>{const s=localStorage.getItem("refresh_token");if(s)try{const t=new URLSearchParams;t.append("grant_type","refresh_token"),t.append("refresh_token",s),t.append("client_id",wt());const e=await M.post(bt,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).json();if(e.access_token&&e.refresh_token)return z(e.access_token,e.refresh_token),e.access_token}catch{return localStorage.getItem("access_token")}};function b(s){return s.map(t=>({albumApiId:"album"in t?t.album.uri:void 0,apiId:t.uri,artistApiId:t.artists[0].uri,artistName:t.artists[0].name,addtionalArtists:t.artists.slice(1).map(e=>({name:e.name,apiId:e.uri})),duration:t.duration_ms/1e3,images:"album"in t?t.album.images:[],name:t.name}))}function x(s){return s.map(t=>({apiId:t.uri,name:t.name,images:t.images}))}function A(s){return s.map(t=>({apiId:t.uri,artistName:t.artists[0].name,artistApiId:t.artists[0].id,addtionalArtists:t.artists.slice(1).map(e=>({name:e.name,apiId:e.id})),name:t.name,images:t.images}))}class kt{constructor(){this.name="spotify",this.previousState=null,this.initializePlayer=()=>{const t=new window.Spotify.Player({getOAuthToken:async e=>{const a=await H();a&&e(a)},name:"AudioGata Player"});t.addListener("initialization_error",e=>{console.error(e)}),t.addListener("authentication_error",e=>{console.error(e)}),t.addListener("account_error",e=>{console.error(e)}),t.addListener("playback_error",e=>{console.error(e)}),t.addListener("player_state_changed",async e=>{e?(this.interval=setInterval(async()=>{let a=await t.getCurrentState();a&&await application.setTrackTime(a.position/1e3)},1e3),e&&this.previousState&&!this.previousState.paused&&e.paused&&e.position===0&&(this.previousState=e,this.interval&&clearInterval(this.interval),setTimeout(application.endTrack,100)),this.previousState=e):this.interval&&clearInterval(this.interval)}),t.addListener("ready",({device_id:e})=>{console.log("Ready with Device ID",e),this.deviceId=e,this.resolveReady(void 0)}),t.addListener("not_ready",({device_id:e})=>{console.log("Device ID has gone offline",e)}),t.connect()},this.deviceId="",window.onSpotifyWebPlaybackSDKReady=this.initializePlayer.bind(this),this.readyPromise=new Promise(t=>{this.resolveReady=t})}loadScript(){const t=document.createElement("script");t.id="spotify-player",t.type="text/javascript",t.async=!1,t.defer=!0,t.src="https://sdk.scdn.co/spotify-player.js",document.head.appendChild(t)}async play(t){const e=new Promise((n,o)=>{setTimeout(()=>o(),5e3)});if(await Promise.race([this.readyPromise,e]),!this.deviceId)return;const a=`${p}/me/player/play?device_id=${this.deviceId}`,r=t.apiId||"";await l.put(a,{json:{uris:[r],position_ms:(t.seekTime??0)*1e3},headers:{"Content-Type":"application/json"}})}async pause(){this.deviceId&&this.previousState&&!this.previousState.paused&&await l.put("https://api.spotify.com/v1/me/player/pause",{headers:{"Content-Type":"application/json"}})}async resume(){this.deviceId&&await l.put(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{headers:{"Content-Type":"application/json"}})}async seek(t){this.deviceId&&await l.put(`https://api.spotify.com/v1/me/player/seek?position_ms=${t*1e3}&device_id=${this.deviceId}`,{headers:{"Content-Type":"application/json"}})}async setVolume(t){await l.put(`https://api.spotify.com/v1/me/player/volume?volume_percent=${Math.round(t*100)}`,{headers:{"Content-Type":"application/json"}})}}async function Pt(s){const t=`${p}/search?q=${encodeURIComponent(s.query)}&type=album,artist,track`,e=await l.get(t).json(),a=b(e.tracks?.items||[]),r=A(e.albums?.items||[]),n=x(e.artists?.items||[]);return{tracks:{items:a,pageInfo:e.tracks&&{resultsPerPage:e.tracks.limit,totalResults:e.tracks.total,offset:e.tracks.offset,nextPage:e.tracks.next||void 0,prevPage:e.tracks.previous||void 0}},albums:{items:r,pageInfo:e.albums&&{resultsPerPage:e.albums.limit,totalResults:e.albums.total,offset:e.albums.offset,nextPage:e.albums.next||void 0,prevPage:e.albums.previous||void 0}},artists:{items:n,pageInfo:e.artists&&{resultsPerPage:e.artists.limit,totalResults:e.artists.total,offset:e.artists.offset,nextPage:e.artists.next||void 0,prevPage:e.artists.previous||void 0}}}}async function Tt(s){let t=`${p}/search?q=${encodeURIComponent(s.query)}&type=track`;s.pageInfo?.nextPage?t=s.pageInfo.nextPage:s.pageInfo?.prevPage&&(t=s.pageInfo.prevPage);const e=await l.get(t).json();return{items:b(e.tracks?.items||[]),pageInfo:e.tracks&&{resultsPerPage:e.tracks.limit,totalResults:e.tracks.total,offset:e.tracks.offset,nextPage:e.tracks.next||void 0,prevPage:e.tracks.previous||void 0}}}async function Rt(s){let t=`${p}/search?q=${encodeURIComponent(s.query)}&type=album`;s.pageInfo?.nextPage?t=s.pageInfo.nextPage:s.pageInfo?.prevPage&&(t=s.pageInfo.prevPage);const e=await l.get(t).json();return{items:A(e.albums?.items||[]),pageInfo:e.albums&&{resultsPerPage:e.albums.limit,totalResults:e.albums.total,offset:e.albums.offset,nextPage:e.albums.next||void 0,prevPage:e.albums.previous||void 0}}}async function It(s){let t=`${p}/search?q=${encodeURIComponent(s.query)}&type=track`;s.pageInfo?.nextPage?t=s.pageInfo.nextPage:s.pageInfo?.prevPage&&(t=s.pageInfo.prevPage);const e=await l.get(t).json();return{items:x(e.artists?.items||[]),pageInfo:e.artists&&{resultsPerPage:e.artists.limit,totalResults:e.artists.total,offset:e.artists.offset,nextPage:e.artists.next||void 0,prevPage:e.artists.previous||void 0}}}async function vt(s){const t=s.apiId?.split(":").pop(),e=`${p}/albums/${t}`,a=await l.get(e).json(),r=b(a.tracks.items);return r.forEach(n=>{n.albumApiId=s.apiId,n.images=a.images}),{album:{name:a.name,artistName:a.artists[0].name,artistApiId:a.artists[0].id,addtionalArtists:a.artists.slice(1).map(n=>({name:n.name,apiId:n.id})),apiId:a.id,images:a.images},items:r}}async function St(s){const t=s.apiId?.split(":").pop(),e=`${p}/artists/${t}`;let a=`${p}/artists/${t}/albums`;s.pageInfo?.nextPage?a=s.pageInfo.nextPage:s.pageInfo?.prevPage&&(a=s.pageInfo.prevPage);const r=await l.get(e).json(),n=await l.get(a).json();return{items:A(n.items),pageInfo:{resultsPerPage:n.limit,totalResults:n.total,offset:n.offset,nextPage:n.next||void 0,prevPage:n.previous||void 0},artist:{name:r.name,apiId:r.id,images:r.images}}}async function F(s){const t=`https://api.spotify.com/v1/playlists/${s.apiId}`,e=await l.get(t).json(),a={name:e.name,images:e.images.map(m=>({width:m.width||0,height:m.height||0,url:m.url})),apiId:e.id},r=50;let n=0,o=`${t}/tracks?limit=${r}`;s.pageInfo?.nextPage?o=s.pageInfo.nextPage:s.pageInfo?.prevPage&&(o=s.pageInfo.prevPage);let c=[],i=!0;for(;i;){const m=await l.get(`${o}&offset=${n}`).json(),V=m.items.map(h=>({albumApiId:h.track?.album&&h.track.album.uri,apiId:h.track?.uri,artistName:h.track?.artists[0].name,artistApiId:h.track?.artists[0].uri,addtionalArtists:h.track?.artists.slice(1).map(y=>({name:y.name,apiId:y.uri})),duration:(h.track?.duration_ms||0)/1e3,images:h.track?.album.images.map(y=>({url:y.url,height:y.height||0,width:y.width||0}))||[],name:h.track?.name||""}));c=c.concat(V),n+=r,m.next||(i=!1)}return{playlist:a,items:c}}async function xt(s){let t="https://api.spotify.com/v1/me/playlists";s.pageInfo?.nextPage?t=s.pageInfo.nextPage:s.pageInfo?.prevPage&&(t=s.pageInfo.prevPage);const e=await l.get(t).json();return{items:e.items.map(n=>({name:n.name,images:n.images.map(o=>({width:o.width||0,height:o.height||0,url:o.url})),apiId:n.id})),pageInfo:{resultsPerPage:e.limit,offset:e.offset,totalResults:e.total,nextPage:e.next||void 0,prevPage:e.previous||void 0}}}async function At(){const s="https://api.spotify.com/v1/me/top/tracks",t="https://api.spotify.com/v1/me/top/artists",e=l.get(s).json(),a=l.get(t).json(),r=await Promise.all([e,a]);return{tracks:{items:b(r[0].items)},artists:{items:x(r[1].items)}}}async function jt(s){const t=s.apiId?.split(":").pop(),e=`${p}/artists/${t}`,a=`${p}/artists/${t}/top-tracks`,r=await l.get(e).json(),n=await l.get(a).json();return{items:b(n.tracks),artist:{name:r.name,apiId:r.id,images:r.images}}}const B=/https?:\/\/(?:play|open)\.spotify\.[^\/]+\/(playlist)\/([^\/\?]+)/;async function Et(s){const t=s.match(B);if(t){const e=t[2],a=await F({apiId:e});return{...a.playlist,tracks:a.items}}throw new Error("Can't retreive playlist")}const u=new kt,J=()=>{application.onSearchAll=Pt,application.onGetAlbumTracks=vt,application.onGetArtistAlbums=St,application.onGetPlaylistTracks=F,application.onSearchTracks=Tt,application.onSearchArtists=It,application.onSearchAlbums=Rt,application.onGetUserPlaylists=xt,application.onGetTopItems=At,application.onGetArtistTopTracks=jt,application.onCanParseUrl=async(s,t)=>{switch(t){case"playlist":return B.test(s);default:return!1}},application.onLookupPlaylistUrl=Et,application.onPlay=u.play.bind(u),application.onPause=u.pause.bind(u),application.onResume=u.resume.bind(u),application.onSeek=u.seek.bind(u),application.onSetVolume=u.setVolume.bind(u),u.loadScript()},Ut=async()=>{const s=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");s&&t&&J();const e=await application.getTheme();G(e)};application.onDeepLinkMessage=async s=>{application.postUiMessage({type:"deeplink",url:s})};const $t=async s=>{switch(s.type){case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token");break;case"set-keys":localStorage.setItem("clientId",s.clientId);break;case"check-login":const t=localStorage.getItem("access_token"),e=localStorage.getItem("refresh_token");t&&e&&U({type:"login"});const r=document.location.host.split(".");r.shift();const n=await application.getPluginId(),o=r.join("."),c=`${document.location.protocol}//${o}`,i=localStorage.getItem("clientId")??"";U({type:"info",origin:c,pluginId:n,clientId:i});break;case"login":z(s.accessToken,s.refreshToken),J();break}};application.onUiMessage=$t;const G=s=>{localStorage.setItem("vite-ui-theme",s)};application.onChangeTheme=async s=>{G(s)};Ut();
